% faixa de passagem = 1.5 m
% norma campo elétrico ao nível do solo = 8.33 kV/m
% APROXIMA 1 e 2 m em x da configuração original

clear all; close all; clc

e_0 = 8.854*(10^(-12));
%faixa de passagem
xf = linspace(-25,25,100);
yf = 1.5;

%% aprox 1 m

n1 = 6;
r1 = 14.37*(10^(-3));

x1 = [-9.478 -9.25 -0.228 0 9.022 9.25];
y1 = [14.290 14.290 14.290 14.290 14.290 14.290];
yi1 = -y1;

%% aprox 2 m

n2 = 6;
r2 = 14.37*(10^(-3));

x2 = [-8.478 -8.25 -0.228 0 8.022 8.25];
y2 = [14.290 14.290 14.290 14.290 14.290 14.290];
yi2 = -y2;


%%

P1 = zeros(n1,n1);
for i = 1:n1
     for j = 1:n1
        if(i==j)
           P1(i,j) = (1/(2*pi*e_0))*log((4*y1(i))/(2*r1));
        else
           P1(i,j) = (1/(2*pi*e_0))*log(sqrt((x1(j)-x1(i))^2+(yi1(j)-y1(i))^2)/(sqrt((x1(j)-x1(i))^2+(y1(j)-y1(i))^2)));
        end
     end
end


%%

V1 = 345*10^3;

V1_ra = V1/sqrt(3);
V1_ia = 0;

V1_rb = V1*(cos(2*pi/3))/sqrt(3);
V1_ib = 1i*V1*(sin(2*pi/3))/sqrt(3);

V1_rc = V1*(cos(-2*pi/3))/sqrt(3);
V1_ic = 1i*V1*(sin(-2*pi/3))/sqrt(3);

Vf1 = [ V1_ra+V1_ia ; V1_ra+V1_ia ; V1_rb+V1_ib ; V1_rb+V1_ib ; V1_rc+V1_ic ; V1_rc+V1_ic ];

%%

rho1 = P1\Vf1;

rho1_r1 = real(rho1(1));
rho1_i1 = imag(rho1(1));

rho1_r2 = real(rho1(2));
rho1_i2 = imag(rho1(2));

rho1_r3 = real(rho1(3));
rho1_i3 = imag(rho1(3));

rho1_r4 = real(rho1(4));
rho1_i4 = imag(rho1(4));

rho1_r5 = real(rho1(5));
rho1_i5 = imag(rho1(5));

rho1_r6 = real(rho1(6));
rho1_i6 = imag(rho1(6));

%%

E1_xr1 = (rho1_r1/(2*pi*e_0)).*((xf - x1(1))./(((xf - x1(1)).^2) + (yf - y1(1)).^2) - (xf - x1(1))./(((xf - x1(1)).^2) + (yf + y1(1)).^2));
E1_xr2 = (rho1_r2/(2*pi*e_0)).*((xf - x1(2))./(((xf - x1(2)).^2) + (yf - y1(2)).^2) - (xf - x1(2))./(((xf - x1(2)).^2) + (yf + y1(2)).^2));
E1_xr3 = (rho1_r3/(2*pi*e_0)).*((xf - x1(3))./(((xf - x1(3)).^2) + (yf - y1(3)).^2) - (xf - x1(3))./(((xf - x1(3)).^2) + (yf + y1(3)).^2));
E1_xr4 = (rho1_r4/(2*pi*e_0)).*((xf - x1(4))./(((xf - x1(4)).^2) + (yf - y1(4)).^2) - (xf - x1(4))./(((xf - x1(4)).^2) + (yf + y1(4)).^2));
E1_xr5 = (rho1_r5/(2*pi*e_0)).*((xf - x1(5))./(((xf - x1(5)).^2) + (yf - y1(5)).^2) - (xf - x1(5))./(((xf - x1(5)).^2) + (yf + y1(5)).^2));
E1_xr6 = (rho1_r6/(2*pi*e_0)).*((xf - x1(6))./(((xf - x1(6)).^2) + (yf - y1(6)).^2) - (xf - x1(6))./(((xf - x1(6)).^2) + (yf + y1(6)).^2));

E1_xi1 = (rho1_i1/(2*pi*e_0)).*((xf - x1(1))./(((xf - x1(1)).^2) + (yf - y1(1)).^2) - (xf - x1(1))./(((xf - x1(1)).^2) + (yf + y1(1)).^2));
E1_xi2 = (rho1_i2/(2*pi*e_0)).*((xf - x1(2))./(((xf - x1(2)).^2) + (yf - y1(2)).^2) - (xf - x1(2))./(((xf - x1(2)).^2) + (yf + y1(2)).^2));
E1_xi3 = (rho1_i3/(2*pi*e_0)).*((xf - x1(3))./(((xf - x1(3)).^2) + (yf - y1(3)).^2) - (xf - x1(3))./(((xf - x1(3)).^2) + (yf + y1(3)).^2));
E1_xi4 = (rho1_i4/(2*pi*e_0)).*((xf - x1(4))./(((xf - x1(4)).^2) + (yf - y1(4)).^2) - (xf - x1(4))./(((xf - x1(4)).^2) + (yf + y1(4)).^2));
E1_xi5 = (rho1_i5/(2*pi*e_0)).*((xf - x1(5))./(((xf - x1(5)).^2) + (yf - y1(5)).^2) - (xf - x1(5))./(((xf - x1(5)).^2) + (yf + y1(5)).^2));
E1_xi6 = (rho1_i6/(2*pi*e_0)).*((xf - x1(6))./(((xf - x1(6)).^2) + (yf - y1(6)).^2) - (xf - x1(6))./(((xf - x1(6)).^2) + (yf + y1(6)).^2));

E1_yr1 = (rho1_r1/(2*pi*e_0)).*((yf - y1(1))./(((xf - x1(1)).^2) + (yf - y1(1)).^2) - (yf + y1(1))./(((xf - x1(1)).^2) + (yf + y1(1)).^2));
E1_yr2 = (rho1_r2/(2*pi*e_0)).*((yf - y1(2))./(((xf - x1(2)).^2) + (yf - y1(2)).^2) - (yf + y1(2))./(((xf - x1(2)).^2) + (yf + y1(2)).^2));
E1_yr3 = (rho1_r3/(2*pi*e_0)).*((yf - y1(3))./(((xf - x1(3)).^2) + (yf - y1(3)).^2) - (yf + y1(3))./(((xf - x1(3)).^2) + (yf + y1(3)).^2));
E1_yr4 = (rho1_r4/(2*pi*e_0)).*((yf - y1(4))./(((xf - x1(4)).^2) + (yf - y1(4)).^2) - (yf + y1(4))./(((xf - x1(4)).^2) + (yf + y1(4)).^2));
E1_yr5 = (rho1_r5/(2*pi*e_0)).*((yf - y1(5))./(((xf - x1(5)).^2) + (yf - y1(5)).^2) - (yf + y1(5))./(((xf - x1(5)).^2) + (yf + y1(5)).^2));
E1_yr6 = (rho1_r6/(2*pi*e_0)).*((yf - y1(6))./(((xf - x1(6)).^2) + (yf - y1(6)).^2) - (yf + y1(6))./(((xf - x1(6)).^2) + (yf + y1(6)).^2));

E1_yi1 = (rho1_i1/(2*pi*e_0)).*((yf - y1(1))./(((xf - x1(1)).^2) + (yf - y1(1)).^2) - (yf + y1(1))./(((xf - x1(1)).^2) + (yf + y1(1)).^2));
E1_yi2 = (rho1_i2/(2*pi*e_0)).*((yf - y1(2))./(((xf - x1(2)).^2) + (yf - y1(2)).^2) - (yf + y1(2))./(((xf - x1(2)).^2) + (yf + y1(2)).^2));
E1_yi3 = (rho1_i3/(2*pi*e_0)).*((yf - y1(3))./(((xf - x1(3)).^2) + (yf - y1(3)).^2) - (yf + y1(3))./(((xf - x1(3)).^2) + (yf + y1(3)).^2));
E1_yi4 = (rho1_i4/(2*pi*e_0)).*((yf - y1(4))./(((xf - x1(4)).^2) + (yf - y1(4)).^2) - (yf + y1(4))./(((xf - x1(4)).^2) + (yf + y1(4)).^2));
E1_yi5 = (rho1_i5/(2*pi*e_0)).*((yf - y1(5))./(((xf - x1(5)).^2) + (yf - y1(5)).^2) - (yf + y1(5))./(((xf - x1(5)).^2) + (yf + y1(5)).^2));
E1_yi6 = (rho1_i6/(2*pi*e_0)).*((yf - y1(6))./(((xf - x1(6)).^2) + (yf - y1(6)).^2) - (yf + y1(6))./(((xf - x1(6)).^2) + (yf + y1(6)).^2));

%%

E1_xr = [ E1_xr1;  E1_xr2 ;  E1_xr3 ; E1_xr4 ; E1_xr5 ; E1_xr6 ];

E1_ximag = [ E1_xi1;  E1_xi2 ;  E1_xi3 ; E1_xi4 ; E1_xi5 ; E1_xi6 ];

E1_yr = [ E1_yr1;  E1_yr2 ;  E1_yr3 ; E1_yr4 ; E1_yr5 ; E1_yr6 ];

E1_yimag = [ E1_yi1;  E1_yi2 ;  E1_yi3 ; E1_yi4 ; E1_yi5 ; E1_yi6 ];


%%

E1xr = sum(E1_xr).^2;

E1ximag = sum(E1_ximag).^2;

E1yr = sum(E1_yr).^2;

E1yimag = sum(E1_yimag).^2;

E1rms = (E1xr+E1ximag+E1yr+E1yimag).^(1/2);

%%

P2 = zeros(n2,n2);
for i = 1:n2
     for j = 1:n2
        if(i==j)
           P2(i,j) = (1/(2*pi*e_0))*log((4*y2(i))/(2*r2));
        else
           P2(i,j) = (1/(2*pi*e_0))*log(sqrt((x2(j)-x2(i))^2+(yi2(j)-y2(i))^2)/(sqrt((x2(j)-x2(i))^2+(y2(j)-y2(i))^2)));
        end
     end
end


%%

V2 = 345*10^3;

V2_ra = V2/sqrt(3);
V2_ia = 0;

V2_rb = V2*(cos(2*pi/3))/sqrt(3);
V2_ib = 1i*V2*(sin(2*pi/3))/sqrt(3);

V2_rc = V2*(cos(-2*pi/3))/sqrt(3);
V2_ic = 1i*V2*(sin(-2*pi/3))/sqrt(3);

Vf2 = [ V2_ra+V2_ia ; V2_ra+V2_ia ; V2_rb+V2_ib ; V2_rb+V2_ib ; V2_rc+V2_ic ; V2_rc+V2_ic ];

%% AP : Funciona destas duas maneiras e a ultima é mais rápida a barra invertida indica inversão de P:
rho2 = P2\Vf2;

%busco cada uma das posicoes de rho real e imaginario (ver indice)

%cabo 1 fase a
rho2_r1 = real(rho2(1)); 
rho2_i1 = imag(rho2(1));

%cabo 2 fase a
rho2_r2 = real(rho2(2));
rho2_i2 = imag(rho2(2));

%cabo 3 fase b
rho2_r3 = real(rho2(3));
rho2_i3 = imag(rho2(3));

%cabo 4 fase b
rho2_r4 = real(rho2(4));
rho2_i4 = imag(rho2(4));

%cabo 5 fase c
rho2_r5 = real(rho2(5));
rho2_i5 = imag(rho2(5));

%cabo 6 fase c
rho2_r6 = real(rho2(6));
rho2_i6 = imag(rho2(6));

%% 

E2_xr1 = (rho2_r1/(2*pi*e_0)).*((xf - x2(1))./(((xf - x2(1)).^2) + (yf - y2(1)).^2) - (xf - x2(2))./(((xf - x2(1)).^2) + (yf + y2(1)).^2));
E2_xr2 = (rho2_r2/(2*pi*e_0)).*((xf - x2(2))./(((xf - x2(2)).^2) + (yf - y2(2)).^2) - (xf - x2(2))./(((xf - x2(2)).^2) + (yf + y2(2)).^2));
E2_xr3 = (rho2_r3/(2*pi*e_0)).*((xf - x2(3))./(((xf - x2(3)).^2) + (yf - y2(3)).^2) - (xf - x2(3))./(((xf - x2(3)).^2) + (yf + y2(3)).^2));

E2_xr4 = (rho2_r4/(2*pi*e_0)).*((xf - x2(4))./(((xf - x2(4)).^2) + (yf - y2(4)).^2) - (xf - x2(4))./(((xf - x2(4)).^2) + (yf + y2(4)).^2));
E2_xr5 = (rho2_r5/(2*pi*e_0)).*((xf - x2(5))./(((xf - x2(5)).^2) + (yf - y2(5)).^2) - (xf - x2(5))./(((xf - x2(5)).^2) + (yf + y2(5)).^2));
E2_xr6 = (rho2_r6/(2*pi*e_0)).*((xf - x2(6))./(((xf - x2(6)).^2) + (yf - y2(6)).^2) - (xf - x2(6))./(((xf - x2(6)).^2) + (yf + y2(6)).^2));

E2_xi1 = (rho2_i1/(2*pi*e_0)).*((xf - x2(1))./(((xf - x2(1)).^2) + (yf - y2(1)).^2) - (xf - x2(1))./(((xf - x2(1)).^2) + (yf + y2(1)).^2));
E2_xi2 = (rho2_i2/(2*pi*e_0)).*((xf - x2(2))./(((xf - x2(2)).^2) + (yf - y2(2)).^2) - (xf - x2(2))./(((xf - x2(2)).^2) + (yf + y2(2)).^2));
E2_xi3 = (rho2_i3/(2*pi*e_0)).*((xf - x2(3))./(((xf - x2(3)).^2) + (yf - y2(3)).^2) - (xf - x2(3))./(((xf - x2(3)).^2) + (yf + y2(3)).^2));

E2_xi4 = (rho2_i4/(2*pi*e_0)).*((xf - x2(4))./(((xf - x2(4)).^2) + (yf - y2(4)).^2) - (xf - x2(4))./(((xf - x2(4)).^2) + (yf + y2(4)).^2));
E2_xi5 = (rho2_i5/(2*pi*e_0)).*((xf - x2(5))./(((xf - x2(5)).^2) + (yf - y2(5)).^2) - (xf - x2(5))./(((xf - x2(5)).^2) + (yf + y2(5)).^2));
E2_xi6 = (rho2_i6/(2*pi*e_0)).*((xf - x2(6))./(((xf - x2(6)).^2) + (yf - y2(6)).^2) - (xf - x2(6))./(((xf - x2(6)).^2) + (yf + y2(6)).^2));

E2_yr1 = (rho2_r1/(2*pi*e_0)).*((yf - y2(1))./(((xf - x2(1)).^2) + (yf - y2(1)).^2) - (yf + y2(1))./(((xf - x2(1)).^2) + (yf + y2(1)).^2));
E2_yr2 = (rho2_r2/(2*pi*e_0)).*((yf - y2(2))./(((xf - x2(2)).^2) + (yf - y2(2)).^2) - (yf + y2(2))./(((xf - x2(2)).^2) + (yf + y2(2)).^2));
E2_yr3 = (rho2_r3/(2*pi*e_0)).*((yf - y2(3))./(((xf - x2(3)).^2) + (yf - y2(3)).^2) - (yf + y2(3))./(((xf - x2(3)).^2) + (yf + y2(3)).^2));

E2_yr4 = (rho2_r4/(2*pi*e_0)).*((yf - y2(4))./(((xf - x2(4)).^2) + (yf - y2(4)).^2) - (yf + y2(4))./(((xf - x2(4)).^2) + (yf + y2(4)).^2));
E2_yr5 = (rho2_r5/(2*pi*e_0)).*((yf - y2(5))./(((xf - x2(5)).^2) + (yf - y2(5)).^2) - (yf + y2(5))./(((xf - x2(5)).^2) + (yf + y2(5)).^2));
E2_yr6 = (rho2_r6/(2*pi*e_0)).*((yf - y2(6))./(((xf - x2(6)).^2) + (yf - y2(6)).^2) - (yf + y2(6))./(((xf - x2(6)).^2) + (yf + y2(6)).^2));

E2_yi1 = (rho2_i1/(2*pi*e_0)).*((yf - y2(1))./(((xf - x2(1)).^2) + (yf - y2(1)).^2) - (yf + y2(1))./(((xf - x2(1)).^2) + (yf + y2(1)).^2));
E2_yi2 = (rho2_i2/(2*pi*e_0)).*((yf - y2(2))./(((xf - x2(2)).^2) + (yf - y2(2)).^2) - (yf + y2(2))./(((xf - x2(2)).^2) + (yf + y2(2)).^2));
E2_yi3 = (rho2_i3/(2*pi*e_0)).*((yf - y2(3))./(((xf - x2(3)).^2) + (yf - y2(3)).^2) - (yf + y2(3))./(((xf - x2(3)).^2) + (yf + y2(3)).^2));

E2_yi4 = (rho2_i4/(2*pi*e_0)).*((yf - y2(1))./(((xf - x2(4)).^2) + (yf - y2(4)).^2) - (yf + y2(4))./(((xf - x2(4)).^2) + (yf + y2(4)).^2));
E2_yi5 = (rho2_i5/(2*pi*e_0)).*((yf - y2(2))./(((xf - x2(5)).^2) + (yf - y2(5)).^2) - (yf + y2(5))./(((xf - x2(5)).^2) + (yf + y2(5)).^2));
E2_yi6 = (rho2_i6/(2*pi*e_0)).*((yf - y2(3))./(((xf - x2(6)).^2) + (yf - y2(6)).^2) - (yf + y2(6))./(((xf - x2(6)).^2) + (yf + y2(6)).^2));


%% AP: aqui em cada matriz dessa tem as componentes geradas na direção x e y, pela parte real e imaginária de cada carga elétrica:

E2_xr = [ E2_xr1;  E2_xr2 ;  E2_xr3 ; E2_xr4 ; E2_xr5 ; E2_xr6 ];

E2_ximag = [ E2_xi1;  E2_xi2 ;  E2_xi3 ; E2_xi4 ; E2_xi5 ; E2_xi6 ];

E2_yr = [ E2_yr1;  E2_yr2 ;  E2_yr3 ; E2_yr4 ; E2_yr5 ; E2_yr6 ];

E2_yimag = [ E2_yi1;  E2_yi2 ;  E2_yi3 ; E2_yi4 ; E2_yi5 ; E2_yi6 ];


%% AP: aqui somamos as componentes (elementos das colunas) em cada direção e elevamos ao quadrado

E2xr = sum(E2_xr).^2;

E2ximag = sum(E2_ximag).^2;

E2yr = sum(E2_yr).^2;

E2yimag = sum(E2_yimag).^2;

E2rms = (E2xr+E2ximag+E2yr+E2yimag).^(1/2);


%%

Enorma = linspace(8330,8330,100);

E2rms_or = [1552.25056827995 1615.16094491835 1680.24991960434 1747.45790273704 1816.69494084353 1887.83589934115 1960.71529907886 2035.12188395536 2110.79303608247 2187.40920215767 2264.58854970680 2341.88213357035 2418.76991916499 2494.65807588347 2568.87801595036 2640.68770366406 2709.27578794052 2773.76910677570 2833.24406455263 2886.74228191383 2933.29075600190 2971.92654421851 3001.72570260882 3021.83588486152 3031.51166333845 3030.15130087043 3017.33341651761 2992.85178315675 2956.74639294902 2909.32893439840 2851.20092459848 2783.26289029535 2706.71312943157 2623.03464250038 2533.96875145673 2441.47373459352 2347.66662756862 2254.74648401784 2164.89838190782 2080.17997793290 2002.39697470122 1932.98025860164 1872.88405332376 1822.52800992164 1781.80312629071 1750.15025606532 1726.70340648036 1710.47424001670 1700.54526613854 1696.23935014799 1697.24010092815 1703.64725639750 1715.96041521344 1734.99290703391 1761.72635695634 1797.12619505502 1841.94737572099 1896.56404108725 1960.85297369990 2034.14798924255 2115.26524457523 2202.58456484135 2294.16431502297 2387.86771777251 2481.48401324175 2572.83474911093 2659.86120613417 2740.69258228502 2813.69629578021 2877.51228320029 2931.07309993719 2973.61140928626 3004.65629524182 3024.01981978517 3031.77534537537 3028.22929488660 3013.88815579388 2989.42259835081 2955.63053749688 2913.40081880586 2863.67896447832 2807.43610482821 2745.64187881692 2679.24174808461 2609.13886085795 2536.18034461364 2461.14770963665 2384.75091144880 2307.62554389043 2230.33260765599 2153.36031054942 2077.12739458929 2001.98754123689 1928.23447093824 1856.10742026268 1785.79674445474 1717.44945213025 1651.17453043960 1587.04796262535 1525.11737558953];


h = figure();
plot(xf,E2rms_or,'-','LineWidth',3.5)
xlabel('Faixa de passagem (m)')
ylabel('Campo elétrico (V/m)')
grid
hold on
plot(xf,E1rms,':','LineWidth',3.5)
hold on
plot(xf,E2rms,'-.','LineWidth',3.5)
hold on
plot(xf,Enorma,'--','LineWidth',3.5)
legend('Original','Aprox. 1 m', 'Aprox. 2 m', 'Limite da norma')
set(gca, 'YScale', 'log')
ylim([0 9000])

set(h,'Units','Inches');
pos = get(h,'Position');
set(h,'PaperPositionMode','Auto','PaperUnits','Inches','PaperSize',[pos(3), pos(4)])
%print(h,'solo_caso1_dist','-dpdf','-r0')

% xr1 = [-3 0 3];
% yr1 = [14.01 14.01 14.01];

xr2 = [-10.478 -10.25 -0.228 0 10.022 10.25];
yr2 = [14.290 14.290 14.290 14.290 14.290 14.290];

% xr3 = [-10.478 -10.25 -10.021 -0.228 0 0.228 10.021 10.25 10.478];
% yr3 = [16.530 16.758 16.530 16.530 16.758 16.530 16.530 16.758 16.530];
% 
% xr4 = [-7.975 -7.025 -7.025 -7.975 -0.475 0.475 0.475 -0.475 7.025 7.975 7.975 7.025];
% yr4 = [18.45 18.45 17.5 17.5 25.95 25.95 25 25 18.45 18.45 17.5 17.5];

g = figure();
plot(xr2,yr2,'o','color','b')
xlabel('Faixa de passagem (m)')
ylabel('Altura dos cabos (m)')
grid
hold on
plot(x1,y1,'*','color','r')
hold on
plot(x2,y2,'x','color','r')
legend('Original','Aprox. 1 m', 'Aprox. 2 m')
% xlim([-3.5 3.5])
% ylim([11.5 16.5])

set(g,'Units','Inches');
pos = get(g,'Position');
set(g,'PaperPositionMode','Auto','PaperUnits','Inches','PaperSize',[pos(3), pos(4)])
print(g,'solo_caso1_dist_config','-dpdf','-r0')